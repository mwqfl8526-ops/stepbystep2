<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุดูุงูู ูุงูุงูุชุฑุงุญุงุช</title>
    <link rel="stylesheet" href="style.css">
    <script src="data_config.js"></script>
</head>
<body>
    <div class="header-controls">
        <a href="manager_dashboard.html" class="btn-back">๐ ููุญุฉ ุงููุฏูุฑ</a>
    </div>

    <div class="container">
        <h1>ุงูุดูุงูู ูุงูุงูุชุฑุงุญุงุช ุงููุงุฑุฏุฉ ๐ง</h1>
        <p>ููุง ูุชู ุนุฑุถ ุฌููุน ุงูุฑุณุงุฆู ุงููุงุฑุฏุฉ ูู ูููุฐุฌ ุงูุดูุงูู ูุงูุงูุชุฑุงุญุงุช.</p>
        
        <button onclick="displayComplaints()" class="btn-primary" style="margin-top: 15px;">๐ ุชุญุฏูุซ ุงููุงุฆูุฉ</button>

        <div id="complaintsList" class="requests-table-container">
            <table class="requests-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ููุช ุงูุฅุฑุณุงู</th>
                        <th>ุงูููุน</th>
                        <th>ุชูุงุตูู ุงูุฑุณุงูุฉ</th>
                        <th>ุงูุฅุฌุฑุงุกุงุช</th>
                    </tr>
                </thead>
                <tbody id="complaintsTableBody">
                    </tbody>
            </table>
        </div>
        
        <p id="noComplaintsMessage" style="text-align: center; color: var(--gold); margin-top: 50px; display: none;">ูุง ุชูุฌุฏ ุดูุงูู ุฃู ุงูุชุฑุงุญุงุช ุฌุฏูุฏุฉ.</p>
    </div>

    <script>
        const loadData = window.loadData;
        const deleteComplaint = window.deleteComplaint;
        const KEYS = window.KEYS;

        function displayComplaints() {
            const data = loadData();
            const complaints = data[KEYS.COMPLAINTS] || [];
            const tbody = document.getElementById('complaintsTableBody');
            const noComplaintsMessage = document.getElementById('noComplaintsMessage');
            tbody.innerHTML = '';

            if (complaints.length === 0) {
                noComplaintsMessage.style.display = 'block';
                return;
            }
            noComplaintsMessage.style.display = 'none';

            complaints.forEach(c => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${c.id}</td>
                    <td>${c.time}</td>
                    <td><span class="status-badge" style="background-color: ${c.type === 'ุดููู' ? 'var(--red-emergency)' : 'var(--blue-royal)'}">${c.type}</span></td>
                    <td>${c.message.length > 50 ? c.message.substring(0, 50) + '...' : c.message}</td>
                    <td><button onclick="viewAndRemove('${c.id}', '${c.message.replace(/'/g, "\\'")}')" class="btn-back">ุนุฑุถ/ุญุฐู</button></td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function viewAndRemove(id, message) {
            const fullMessage = message.replace(/\\'/g, "'");
            if (confirm(`ุฑุณุงูุฉ (${id}):\n\n${fullMessage}\n\nูู ุชุฑูุฏ ุญุฐู ูุฐู ุงูุฑุณุงูุฉ ุจุนุฏ ูุฑุงุกุชูุงุ`)) {
                if (deleteComplaint(id)) {
                    alert('โ ุชู ุญุฐู ุงูุฑุณุงูุฉ ุจูุฌุงุญ.');
                    displayComplaints();
                } else {
                    alert('โ ูุดู ุญุฐู ุงูุฑุณุงูุฉ.');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', displayComplaints);
    </script>
</body>
</html>
