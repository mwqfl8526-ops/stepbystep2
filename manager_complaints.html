<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body {
            background-color: #1e1e2f;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .header-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .btn-back, .btn-primary {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-back {
            background-color: #555;
            color: #fff;
        }
        .btn-primary {
            background-color: #4169e1;
            color: #fff;
        }
        .requests-table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        .requests-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .requests-table th, .requests-table td {
            border: 1px solid #444;
            padding: 12px 10px;
            text-align: right;
        }
        .requests-table th {
            background-color: #4169e1;
            color: #fff;
            font-weight: bold;
        }
        .requests-table tr:nth-child(even) {
            background-color: #2a2a2a;
        }
        .requests-table tr:hover {
            background-color: #333;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            color: #1e1e2f;
        }
    </style>
</head>
<body>
    <div class="header-controls">
        <a href="manager_dashboard.html" class="btn-back">ğŸ”™ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</a>
    </div>
    <div class="container">
        <h1>Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© ğŸ“§</h1>
        <p>Ù‡Ù†Ø§ ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© Ù…Ù† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª.</p>
        <button onclick="displayComplaints()" class="btn-primary" style="margin-top: 15px;">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>

        <div class="requests-table-container">
            <table class="requests-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ÙˆÙ‚Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„Ø§Ø³Ù…</th> 
                        <th>Ø§Ù„Ù‡Ø§ØªÙ</th> 
                        <th>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="complaintsTableBody"></tbody>
            </table>
        </div>
        <p id="noComplaintsMessage" style="text-align:center; color:gold; margin-top:50px; display:none;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.</p>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyDpVqFWJfB4rA2-NA4QIl1w07e2LFQaYic",
          authDomain: "tourguideapp-313c1.firebaseapp.com",
          databaseURL: "https://tourguideapp-313c1-default-rtdb.firebaseio.com",
          projectId: "tourguideapp-313c1",
          storageBucket: "tourguideapp-313c1.firebasestorage.app",
          messagingSenderId: "1036127588385",
          appId: "1:1036127588385:web:d144dba8f70fe094395360"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function displayComplaints() {
            const tbody = document.getElementById('complaintsTableBody');
            const noComplaintsMessage = document.getElementById('noComplaintsMessage');
            tbody.innerHTML = '';

            db.ref('complaints').once('value').then(snapshot => {
                const complaints = snapshot.val();
                if (!complaints) {
                    noComplaintsMessage.style.display = 'block';
                    return;
                }
                noComplaintsMessage.style.display = 'none';
                Object.values(complaints).forEach(c => {
                    const tr = document.createElement('tr');
                    const badgeColor = c.type === 'Ø´ÙƒÙˆÙ‰' ? '#ff4d4d' : '#4169e1';
                    tr.innerHTML = `
                        <td>${c.id}</td>
                        <td>${c.time}</td>
                        <td><span class="status-badge" style="background-color:${badgeColor}; color:#fff;">${c.type}</span></td>
                        <td>${c.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        <td>${c.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        <td>${c.message.length>50 ? c.message.substring(0,50)+'...' : c.message}</td>
                        <td><button onclick="viewAndRemove('${c.id}', '${c.message.replace(/'/g, "\\'")}', '${c.name.replace(/'/g, "\\'")}', '${c.phone.replace(/'/g, "\\'")}')" class="btn-back" style="background-color:#ff4d4d; border:none;">Ø¹Ø±Ø¶/Ø­Ø°Ù</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            });
        }

        function viewAndRemove(id, message, name, phone) {
            const fullMessage = message.replace(/\\'/g, "'");
            const confirmationText = `Ø±Ø³Ø§Ù„Ø© (${id}) - Ø§Ù„Ù†ÙˆØ¹: ${name}\nØ§Ù„Ø§Ø³Ù…: ${name}\nØ§Ù„Ù‡Ø§ØªÙ: ${phone}\n\nØ§Ù„ØªÙØ§ØµÙŠÙ„:\n${fullMessage}\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ù‚Ø±Ø§Ø¡ØªÙ‡Ø§ØŸ`;
            if(confirm(confirmationText)) {
                db.ref('complaints/' + id).remove()
                  .then(()=> { alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­.'); displayComplaints(); })
                  .catch(err=> { alert('âŒ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©.'); console.error(err); });
            }
        }

        document.addEventListener('DOMContentLoaded', displayComplaints);
    </script>
</body>
</html>