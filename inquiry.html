<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø·Ù„Ø¨ ØªÙˆØ¸ÙŠÙ</title>
    <style>
        :root {
            --dark-bg: #121212;
            --card-bg: #1f1f1f;
            --gold: #ffc107;
            --blue-royal: #4a6fa5;
            --white: #e0e0e0;
            --border-color: #333333;
            --red-emergency: #cf6679;
            --green-success: #4caf50;
            --yellow-warning: #ffeb3b;
            --text-color: #e0e0e0;
        }
        body {background-color: var(--dark-bg); color: var(--text-color); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; direction:rtl;}
        .header-controls {display:flex; justify-content:flex-end; padding:15px; background-color:#1f1f1f; border-bottom:1px solid var(--border-color);}
        .btn-back {background-color:var(--blue-royal); color:var(--white); padding:8px 15px; border-radius:6px; text-decoration:none; font-size:0.9em; transition:background-color 0.3s; border:none; cursor:pointer; margin-left:10px;}
        .btn-back:hover {background-color:#3b5b82;}
        .inquiry-container {max-width: 500px; margin: 50px auto; padding: 30px; background-color: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.5);}
        .result-box {margin-top: 25px; padding: 20px; border-radius: 8px; border: 1px solid var(--border-color); background-color: #2a2a2a;}
        .status-badge {display: inline-block; padding: 5px 10px; border-radius: 5px; font-weight: bold; margin-top: 10px;}
        .status-pending { background-color: var(--blue-royal); color: var(--white); }
        .status-accepted { background-color: var(--green-success); color: var(--dark-bg); }
        .status-rejected { background-color: var(--red-emergency); color: var(--white); }
        .completion-link {display: block; margin-top: 15px; text-align: center;}
        .error-message {color: var(--red-emergency) !important; font-weight: bold; text-align: center;}
        .btn-primary {background-color: var(--gold); color: var(--dark-bg); padding:8px 12px; border-radius:6px; text-decoration:none; display:inline-block; margin-top:5px;}
        .btn-primary:hover {background-color:#e0a800;}
        .form-group {margin-bottom:15px;}
        input[type="text"] {width:100%; padding:10px; border-radius:6px; border:1px solid var(--blue-royal); background:#2a2a2a; color:var(--white);}
        button.btn-submit {width:100%; padding:10px; background-color: var(--gold); border:none; border-radius:6px; color:var(--dark-bg); cursor:pointer; font-weight:bold;}
        button.btn-submit:hover {background-color:#e0a800;}
    </style>
</head>
<body>

<div class="header-controls">
    <a href="job_application.html" class="btn-back">ğŸ”™ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</a>
    <a href="index.html" class="btn-back">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
</div>

<div class="inquiry-container">
    <h1>ğŸ” Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø·Ù„Ø¨ ØªÙˆØ¸ÙŠÙ</h1>
    <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø°ÙŠ Ø­ØµÙ„Øª Ø¹Ù„ÙŠÙ‡ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ….</p>

    <form id="inquiryForm">
        <div class="form-group">
            <label for="applicationId">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</label>
            <input type="text" id="applicationId" required placeholder="Ù…Ø«Ø§Ù„: 34562">
        </div>
        <button type="submit" class="btn-submit">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ù„Ø¨</button>
    </form>

    <div id="resultBox" class="result-box" style="display:none;"></div>

    <div id="test-info" style="margin-top:20px;font-size:0.85em;color:#aaa;">
       
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDpVqFWJfB4rA2-NA4QIl1w07e2LFQaYic",
  authDomain: "tourguideapp-313c1.firebaseapp.com",
  databaseURL: "https://tourguideapp-313c1-default-rtdb.firebaseio.com",
  projectId: "tourguideapp-313c1",
  storageBucket: "tourguideapp-313c1.appspot.com",
  messagingSenderId: "1036127588385",
  appId: "1:1036127588385:web:d144dba8f70fe094395360"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ROLES = {
    GUIDE: {key:"GUIDE", name:"Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ"},
    COMPANION: {key:"COMPANION", name:"Ù…Ø±Ø§ÙÙ‚ Ù„Ø°ÙˆÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø®Ø§ØµØ©"},
    DRIVER: {key:"DRIVER", name:"Ø³Ø§Ø¦Ù‚ Ù†Ù‚Ù„ Ø®Ø§Øµ"}
};

document.getElementById("inquiryForm").addEventListener("submit", async function(e){
    e.preventDefault();
    const id = document.getElementById("applicationId").value.trim();
    const result = document.getElementById("resultBox");
    result.style.display="none";
    result.innerHTML="";

    if(!id){
        result.innerHTML="<p class='error-message'>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨.</p>";
        result.style.display="block";
        return;
    }

    try{
        const dbRef = ref(db);
        const snapshot = await get(child(dbRef, `jobApplications`));
        if(snapshot.exists()){
            const data = snapshot.val();
            let foundApp = null;
            for(const key in data){
                if(data[key].id === id){foundApp = data[key]; break;}
            }

            if(!foundApp){
                result.innerHTML="<p class='error-message'>âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù….</p>";
                result.style.display="block";
                return;
            }

            let statusClass = "status-pending";
            let action = "";

            if(foundApp.status === "ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„"){statusClass="status-accepted";
                action = `<div class="completion-link">
                    <p style="color:var(--green-success);margin-bottom:10px;">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨Ùƒ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.</p>
                    <a href="profile_completion.html?role=${foundApp.roleKey}&appId=${foundApp.id}" class="btn-primary">ğŸ‘¤ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a>
                </div>`;}
            else if(foundApp.status === "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"){statusClass="status-pending";}
            else if(foundApp.status === "Ù…Ø±ÙÙˆØ¶"){statusClass="status-rejected";}

            const roleName = ROLES[foundApp.roleKey] ? ROLES[foundApp.roleKey].name : foundApp.role;

            result.innerHTML = `
                <h2>Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ ${foundApp.id}</h2>
                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${foundApp.fullName}</p>
                <p><strong>Ø§Ù„ÙˆØ¸ÙŠÙØ©:</strong> ${roleName}</p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…:</strong> ${foundApp.submissionTime}</p>
                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> 
                    <span class="status-badge ${statusClass}">${foundApp.status}</span>
                </p>
                ${action}
            `;
            result.style.display="block";
        }else{
            result.innerHTML="<p class='error-message'>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
            result.style.display="block";
        }
    }catch(err){
        console.error(err);
        result.innerHTML="<p class='error-message'>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>";
        result.style.display="block";
    }
});
</script>

</body>
</html>