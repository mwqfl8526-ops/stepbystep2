<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ø§Ø¹Ø¯ Ø³ÙŠØ§Ø­ÙŠ</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background-color:#121212; color:#e0e0e0; }
header { background-color:#1f1f1f; padding:12px; text-align:center; font-weight:bold; font-size:1.2em; position:sticky; top:0; z-index:10; }
#searchContainer { display:flex; padding:12px; gap:8px; background-color:#1f1f1f; }
#searchInput { flex:1; padding:10px; border-radius:20px; border:none; background-color:#2a2a2a; color:#fff; outline:none; }
#searchBtn { padding:0 16px; border:none; border-radius:20px; background-color:#25d366; color:#fff; cursor:pointer; }
#results { padding:12px; display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px; }
.card { background-color:#1f1f1f; border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:6px; }
.card img { width:100%; border-radius:8px; object-fit:cover; height:140px; }
.card h3 { margin:0; font-size:1em; color:#ffc107; }
.card p { margin:0; font-size:0.9em; }
.card button { padding:6px; border:none; border-radius:6px; background-color:#25d366; color:#fff; cursor:pointer; margin-top:auto; }
.card button:hover { background-color:#128c7e; }
</style>
</head>
<body>
<header>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ø§Ø¹Ø¯ Ø³ÙŠØ§Ø­ÙŠ</header>

<div id="searchContainer">
    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù…ØŒ Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ù„ØºØ©...">
    <button id="searchBtn">ğŸ” Ø¨Ø­Ø«</button>
</div>

<div id="results"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDpVqFWJfB4rA2-NA4QIl1w07e2LFQaYic",
  authDomain: "tourguideapp-313c1.firebaseapp.com",
  databaseURL: "https://tourguideapp-313c1-default-rtdb.firebaseio.com",
  projectId: "tourguideapp-313c1",
  storageBucket: "tourguideapp-313c1.appspot.com",
  messagingSenderId: "1036127588385",
  appId: "1:1036127588385:web:d144dba8f70fe094395360"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const guidesRef = ref(db, 'guides'); // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ†

const resultsEl = document.getElementById('results');
const searchInput = document.getElementById('searchInput');

function renderGuides(guides){
    resultsEl.innerHTML = '';
    if(!guides || guides.length===0){
        resultsEl.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</p>';
        return;
    }
    guides.forEach(guide=>{
        const card = document.createElement('div');
        card.classList.add('card');

        const img = document.createElement('img');
        img.src = guide.photo || 'https://via.placeholder.com/220x140?text=No+Image';
        card.appendChild(img);

        const name = document.createElement('h3');
        name.textContent = guide.name;
        card.appendChild(name);

        const city = document.createElement('p');
        city.textContent = 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ' + guide.city;
        card.appendChild(city);

        const language = document.createElement('p');
        language.textContent = 'Ø§Ù„Ù„ØºØ©: ' + guide.language;
        card.appendChild(language);

        const btn = document.createElement('button');
        btn.textContent = 'Ø§Ù„ØªÙˆØ§ØµÙ„';
        btn.onclick = ()=>{ window.location.href = `chat.html?code=${guide.chatCode}&name=`; };
        card.appendChild(btn);

        resultsEl.appendChild(card);
    });
}

async function searchGuides(){
    const term = searchInput.value.trim().toLowerCase();
    if(!term) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø´ÙŠØ¡ Ù„Ù„Ø¨Ø­Ø«');
    
    // Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ†
    const snapshot = await get(guidesRef);
    const allGuides = snapshot.val();
    const guidesList = [];

    for(const key in allGuides){
        const g = allGuides[key];
        // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù…ØŒ Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ù„ØºØ©
        if(g.name.toLowerCase().includes(term) || g.city.toLowerCase().includes(term) || g.language.toLowerCase().includes(term)){
            guidesList.push({...g, chatCode:key});
        }
    }

    renderGuides(guidesList);
}

document.getElementById('searchBtn').addEventListener('click', searchGuides);
searchInput.addEventListener('keypress', e=>{ if(e.key==='Enter') searchGuides(); });

// ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
searchGuides();
</script>
</body>
</html>
